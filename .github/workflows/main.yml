name: Test

on:
  push:
    branches:
      - 3.*
  pull_request:

jobs:
  test:
    name: Test
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2
      - name: Preparar Python v3.11
        uses: actions/setup-python@v2
        with:
          python-version: "3.11"
      - name: Sincronizar con CPython
        run: |
          git submodule update --init --depth=1 cpython
      - name: Instalar dependencias
        run: |
          sudo apt-get update
          sudo apt-get install -y hunspell hunspell-es gettext language-pack-es
          python -m pip install -r requirements.txt
          pip list
          pospell --version
          powrap --version
      - name: TRANSLATORS
        run: |
          diff -Naur TRANSLATORS <(LANG=es python scripts/sort.py < TRANSLATORS)
      - name: Powrap
        run: powrap --check --quiet **/*.po
      - name: Pospell
        run: |
          python scripts/check_spell.py
      - name: Construir documentaciÃ³n
        run: PYTHONWARNINGS=ignore::FutureWarning sphinx-build -j auto -W --keep-going -b html -d cpython/Doc/_build/doctree -D language=es . cpython/Doc/_build/html
